//DM XLVII(=47), CXVI(=116), MCXX(=1120), MCMXIV(=1914)
var symbolmap = {
    'I': 1,
    'V': 5,
    'X': 10,
    'L': 50,
    'C': 100,
    'D': 500,
    'M': 1000,
};
function filterroman(string) {
    return string.toUpperCase().split('').filter(v => symbolmap[v] != undefined).join('');
}
function roman2decimal(string) {
    string = filterroman(string);
    var numbers = string.split('').map(c => symbolmap[c]);
    // while(numbers.length > 1){
    numbers = downscale(numbers);
    // }
    return sum(numbers);
}
function downscale(numbers) {
    var values = [];
    var r = findPeakIndices(numbers);
    var peakIndices = r.peakIndices;
    var valleyIndices = r.valleyIndices;
    var values = [];
    if (numbers.length == 0) {
        return [0];
    }
    if (numbers.length == 1) {
        return [numbers[0]];
    }
    //trim end
    var lastindex = Math.max(last(peakIndices), last(valleyIndices));
    var endtrim = 0;
    if (lastindex < numbers.length - 1) {
        endtrim = sum(numbers.splice(lastindex + 1));
    }
    var temp;
    function custart() {
        values.push(calcMountain(0, 0, valleyIndices[0] - 1, numbers));
        peakIndices.shift();
    }
    function cutend() {
        temp = calcMountain(last(valleyIndices), numbers.length - 1, numbers.length - 1, numbers);
        peakIndices.pop();
        numbers.splice(last(valleyIndices));
    }
    var lastval = 0;
    if (peakIndices.length > valleyIndices.length) {
        // V
        //cut end and start
        custart();
        cutend();
    }
    else if (peakIndices.length == valleyIndices.length) {
        if (r.peakFirst) {
            // V| cut start
            custart();
            lastval = numbers[last(valleyIndices)];
        }
        else {
            //N cut end
            cutend();
        }
    }
    else { //peakIndices.length < valleyIndices.length    
        // ^
        lastval = numbers[last(valleyIndices)];
    }
    for (var i = 0; i < peakIndices.length; i++) {
        var lefti = valleyIndices[i];
        var peaki = peakIndices[i];
        var righti = valleyIndices[i + 1] - 1;
        values.push(calcMountain(lefti, peaki, righti, numbers));
    }
    values[values.length - 1] += lastval;
    if (temp != null) {
        values.push(temp);
    }
    values[values.length - 1] += endtrim;
    return values;
}
function sum(arr) {
    return arr.reduce((acc, c) => acc + c, 0);
}
function last(arr) {
    return arr[arr.length - 1];
}
// start and end are inclusive
function calcMountain(starti, peaki, endi, arr) {
    var sum = 0;
    //upslope
    var flatsums = [];
    var flatsum = 0;
    for (var i = starti; i < peaki; i++) {
        if (arr[i] == arr[i + 1]) {
            flatsum += arr[i];
        }
        else {
            flatsum += arr[i];
            flatsums.push(flatsum);
            flatsum = 0;
        }
    }
    var upslopesum = flatsums.reduce((acc, c) => c - acc, 0);
    //downslope
    for (var i = peaki; i <= endi; i++) {
        sum += arr[i];
    }
    return sum - upslopesum;
}
function findPeakIndices(arr) {
    if (arr.length == 0) {
        return { peakFirst: 1, peakIndices: [], valleyIndices: [] };
    }
    else {
        var peakIndices = [];
        var valleyIndices = [];
        var evaluators = [(a, b) => b - a, (a, b) => a - b];
        var arrs = [valleyIndices, peakIndices];
        var ipf = isPeakFirst(arr);
        arrs[ipf.isPeak].push(0);
        var scanning2peak = 1 - ipf.isPeak;
        var i = ipf.firstChangeIndex;
        while (i < arr.length) {
            let res = scan2extreme(arr, i, evaluators[scanning2peak]);
            arrs[scanning2peak].push(res.peaki);
            i = res.trailingEdgeIndex;
            scanning2peak = 1 - scanning2peak;
        }
        return {
            peakFirst: ipf.isPeak,
            peakIndices,
            valleyIndices,
        };
    }
}
function isPeakFirst(arr) {
    for (var i = 1; i < arr.length; i++) {
        if (arr[i] < arr[i - 1]) {
            return {
                isPeak: 1,
                firstChangeIndex: i,
            };
        }
        else if (arr[i] > arr[i - 1]) {
            return {
                isPeak: 0,
                firstChangeIndex: i,
            };
        }
        else {
            continue;
        }
    }
    return {
        isPeak: 1,
        firstChangeIndex: arr.length
    };
}
function scan2extreme(arr, starti, evaluator) {
    var besti = starti;
    var i = starti + 1;
    for (; i < arr.length; i++) {
        var current = arr[i - 1];
        var leadingedge = arr[i];
        var score = evaluator(leadingedge, current);
        if (score > 0) {
            besti = i;
        }
        if (score < 0) {
            return {
                peaki: besti,
                trailingEdgeIndex: i
            };
        }
    }
    return {
        peaki: besti,
        trailingEdgeIndex: i
    };
}
var romaninput = document.querySelector('#romaninput');
var output = document.querySelector('#output');
romaninput.addEventListener('input', () => {
    output.innerText = roman2decimal(romaninput.value);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2FnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsdURBQXVEO0FBRXZELElBQUksU0FBUyxHQUFHO0lBQ1osR0FBRyxFQUFDLENBQUM7SUFDTCxHQUFHLEVBQUMsQ0FBQztJQUNMLEdBQUcsRUFBQyxFQUFFO0lBQ04sR0FBRyxFQUFDLEVBQUU7SUFDTixHQUFHLEVBQUMsR0FBRztJQUNQLEdBQUcsRUFBQyxHQUFHO0lBQ1AsR0FBRyxFQUFDLElBQUk7Q0FDWCxDQUFBO0FBRUQsU0FBUyxXQUFXLENBQUMsTUFBYTtJQUM5QixPQUFPLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUN6RixDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsTUFBYTtJQUNoQyxNQUFNLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBRTVCLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDckQsNkJBQTZCO0lBQzdCLE9BQU8sR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDNUIsSUFBSTtJQUdKLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQ3ZCLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxPQUFnQjtJQUMvQixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUE7SUFDZixJQUFJLENBQUMsR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDaEMsSUFBSSxXQUFXLEdBQUcsQ0FBQyxDQUFDLFdBQVcs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